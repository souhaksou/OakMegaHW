# 🏙️ 新北市都更地點查詢系統

這是一個以 **Vue 3 + Leaflet**
實作的新北市都市更新地點查詢頁面。使用者需完成 **Google 與 Facebook
登入** 後，才能在地圖上查詢附近的都更地點，並搭配列表檢視與互動操作。

👉 **Demo 網址**： https://oak-mega-hw.vercel.app/

------------------------------------------------------------------------

## 🔍 功能一覽

### 登入與權限控管

-   **Google 登入（原生 SDK）**
    -   使用 Google Identity Services，未使用 Firebase 或第三方套件。
    -   解析 JWT 取得使用者名稱與頭像。
    -   登入成功時以 SweetAlert2 顯示提示。
-   **Facebook 登入（原生 SDK）**
    -   使用 Facebook JavaScript SDK。
    -   取得使用者名稱與頭像。
    -   登入取消或失敗時會顯示錯誤提醒。
-   **登入狀態管理**
    -   透過 Pinia 管理 Google / Facebook 狀態。
    -   使用 `pinia-plugin-persistedstate` 搭配
        `sessionStorage`，避免重新整理後需要重登。
    -   `isAuthenticated` 會判斷兩個平台都登入後才算完成。
-   **路由守衛**
    -   未完成雙重登入會被導向 `/login`。
    -   已登入的使用者若再進入 `/login`，會被導回首頁。
    -   404 頁面同樣受登入狀態保護。

------------------------------------------------------------------------

### 地圖與定位

-   **Leaflet 地圖**
    -   初始定位在預設座標（新北市範圍）。
    -   使用 OpenStreetMap 作為主要底圖，若載入失敗會自動切換到 Carto
        的備用底圖。
-   **使用者位置 Marker**
    -   使用自訂 SVG Icon 區分目前位置。
    -   Tooltip 會顯示 **Google 與 Facebook 的頭像**：
        -   登入後先將頭像網址載入為 Blob URL。
        -   Tooltip 展開時再動態將圖片插入，避免提前載入錯誤。
        -   若圖片載入失敗則使用預設頭像。
-   **地圖點擊互動**
    -   點擊地圖可更新「目前位置」：
        -   第一次移動時，原本位置會變成「上一個位置」的灰色 Marker。
        -   有助於避免誤操作時失去參考點。
    -   確認位置後，可按下「確認」按鈕將地圖移動到目前位置。

------------------------------------------------------------------------

### 都更地點查詢與列表

-   **API 封裝**
    -   使用 axios 建立共用 instance（baseURL、timeout）。
    -   `request.js` 將回傳結果統一包裝成 `{ ok, data, error }`。
    -   `userApi.js` 提供：
        -   `calculateDistance(data)`：查詢附近都更地點。
        -   `getPolygons(query)`：取得 Polygon 資料。
-   **查詢流程**
    -   使用者透過「距離（km）」與「最多顯示筆數」設定查詢條件。
    -   以目前地圖上的使用者位置為中心呼叫 `calculateDistance`。
    -   回傳結果會先依距離與筆數做過濾：
        -   優先取距離在指定範圍內的資料。
        -   若在指定距離內沒有資料，則回退為前 N 筆結果。
-   **地圖 Marker 呈現**
    -   每一筆都更地點會在地圖上顯示 Marker。
    -   Tooltip 內容包含：
        -   站名（stop_name）
        -   名稱（name）
        -   距離（distance）
-   **Polygon 範圍**
    -   透過 `getPolygons` 取得 GeoJSON。
    -   使用 `L.geoJSON` 套用樣式（橘色邊框 + 半透明填色）呈現範圍。

------------------------------------------------------------------------

### 列表、搜尋與分頁

-   **列表呈現**
    -   下方以 table 呈現查詢結果：
        -   顯示站名、名稱、距離（km）。
-   **關鍵字篩選**
    -   透過輸入框依「站名（stop_name）」做字串包含篩選（非模糊搜尋）。
-   **分頁元件（PaginationControl.vue）**
    -   自行實作分頁元件：
        -   第一頁 / 最後一頁按鈕。
        -   上一頁 / 下一頁按鈕。
        -   下拉選單切換目前頁數。
    -   會顯示目前頁面對應的資料範圍與總筆數，例如「顯示第 6--10 筆，共
        23 筆」。
-   **列表與地圖互動**
    -   點擊列表中的某一列：
        -   地圖會移動到該地點的 Marker。
        -   該 Marker 會暫時變成金色 Icon 作為高亮提示，之後自動恢復。
    -   點擊 Marker：
        -   自動計算其在篩選後列表中的索引。
        -   自動切換分頁到該筆資料所在頁面。
        -   對應列會高亮一段時間，幫助使用者對應地圖與列表的位置。

------------------------------------------------------------------------

## 📁 專案架構與技術重點

-   Vue 3（Composition API / `<script setup>`）
-   Pinia + `pinia-plugin-persistedstate`
-   Vue Router
-   Leaflet
-   Axios
-   SweetAlert2
-   Master CSS（切版與樣式）

------------------------------------------------------------------------

## 🎨 UI 與視覺

-   使用 Master CSS 實作版面與樣式。
-   配色與視覺風格參考大橡科技網站主視覺。
-   頁面結構包含：
    -   登入頁（Google / Facebook）
    -   主頁面（地圖 + 查詢控制區 + 列表）

------------------------------------------------------------------------

## 🧾 小結

此專案整合原生第三方登入、地圖呈現、互動查詢與清楚的前端模組化架構，並透過適度的
UX 設計讓查詢流程更加順暢。
